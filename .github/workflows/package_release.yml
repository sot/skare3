name: Release Ska Package
on:
  workflow_call:
    inputs:
      repository:
        description: Repository being released
        required: false
        type: string
        default: ${GITHUB_REPOSITORY}
      sha:
        description: sha of the release
        required: false
        type: string
        default: ${GITHUB_SHA}
    secrets:
      SKARE3_CI_API_TOKEN:
        required: true

jobs:
  patch-release:
    runs-on: ubuntu-latest
    name: Patch Release
    steps:
    - name: Set up Python 3.13
      uses: actions/setup-python@v3
      with:
        python-version: "3.13"
    - name: Fetch Skare3 Tools
      uses: actions/checkout@v6
      with:
        repository: sot/skare3_tools
        ref: master
        path: skare3_tools
    - name: Release Description and Skare3 Issue
      run: |
        python -m pip install setuptools wheel
        python -m pip install -r ./skare3_tools/requirements.txt
        python -m pip install ./skare3_tools
        skare3-release-merge-info --repository ${{ inputs.repository }} --sha ${{ inputs.sha }}
        skare3-create-issue --repository sot/skare3 --latest-release ${{ inputs.repository }} --label 'Package update'
      env:
        GITHUB_API_TOKEN: ${{ secrets.SKARE3_CI_API_TOKEN }}
